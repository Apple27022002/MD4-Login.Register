<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
          integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
            crossorigin="anonymous"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

</head>
<body>
<h1>Danh sách sản phẩm </h1>
<button onclick="findAll()">Hiện dữ liệu</button>
<button onclick="findAllByOrderByPrice()">Hiện dữ liệu sắp xếp theo giá</button>
<button onclick="showAddForm()">Thêm mới</button>


<div>
    <input type="text" id="username">
    <input type="text" id="password">
    <button onclick="login()">login</button>
    <button onclick="logout()">logout</button>
</div>
<hr>
<input type="text" id="from">
<input type="text" id="to">
<button onclick="findByPriceBetween()">Find</button>

<div id="display">

</div>

<script>
    let show = document.getElementById("display");
    const API_product = "http://localhost:8000/products"
    const API = "http://localhost:8000"

    function findAll() {
        $.ajax({
            type: "GET",
            headers:{
                Authorization: 'Bearer ' + localStorage.getItem('token')
            },
            url: API_product,
            success: function (data) {
                console.log(data)
                loadTableProduct(data)
            }, error: function (error) {
                console.log(error);
            }
        })
    }
    function loadTableProduct(products) {
        let str = "";
        for (let i = 0; i < products.length; i++) {
            str += `<table><tr>
                    <td>${products[i].id} .</td>
                    <td>${products[i].name} .</td>
                    <td>${products[i].price} .</td>
                    <td>${products[i].category.name}</td>
                    <td> <button type="button" onclick="showEditForm"> Edit </button></td>
                    <td> <button type="button" > Delete</button></td>
                </tr></table>`
        }
        show.innerHTML = str;
    }

    function findByPriceBetween() {
        let from = document.getElementById('from').value;
        let to = document.getElementById('to').value;
        $.ajax({
            type: "GET",
            headers:{
                Authorization: 'Bearer ' + localStorage.getItem('token')
            },
            url: API_product + "/price-between/?from=" + from + "&to=" + to,
            success: function (data) {
                display(data)
            }, error: function (error) {
                console.log(error);
            }
        })
    }

    function findAllByOrderByPrice() {
        $.ajax({
            type: "GET",
            headers:{
                Authorization: 'Bearer ' + localStorage.getItem('token')
            },
            url: API_product + "/order-by-price",
            success: function (data) {
                display(data)
            }, error: function (error) {
                console.log(error);
            }
        })
    }

    function display(data) {
        let str = ""
        console.log(data)
        for (let i = 0; i < data.length; i++) {
            str += "<h3>" + data[i].name + ", " + data[i].price + "</h3>";
        }
        show.innerHTML = str;
    }

    function showAddForm() {
        let str = "    <input type=\"text\" id=\"name\">\n" +
            "    <input type=\"text\" id=\"price\">\n" +
            "    <input type=\"text\" id=\"category\">\n" +
            "    <button onclick='save()'>Thêm</button>"
        show.innerHTML = str;
    }
    function save() {
        let name = document.getElementById("name").value;
        let price = document.getElementById("price").value;
        let categoryId = document.getElementById("category").value;
        let pro = {
            name: name, //name trước: là tên thuộc tính của đtượng pro , sau :là giá trị được lấy ở trên
            price: price,
            category: {
                id: categoryId
            }
        }
        console.log(pro)
        $.ajax({
                headers: {
                    Authorization: 'Bearer ' + localStorage.getItem('token'),
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                },
                type: 'POST',
                url: 'http://localhost:8000/products',
                data: JSON.stringify(pro),
                success: function () {
                    findAll()
                },
                error: function (error) {
                    console.log(error)
                    alert("Bạn không vào được trang này ")

                }

        })
    }

    function login() {

        let usn = document.getElementById("username").value;
        let pw = document.getElementById("password").value;
        let user = {
            username: usn,
            password: pw,
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
            type: 'POST',
            url: API + "/login",
            data: JSON.stringify(user),
            success: function (data) {
                console.log(data)
                localStorage.setItem('token',data.accessToken);
            },
            error: function (error) {
                console.log(error)
            }
        })
    }
    function showEditForm(id) {
        $.ajax({
            type: "GET",
            headers:{
                Authorization: 'Bearer ' + localStorage.getItem("token")
            },
            url: API + id,
            success: function (data) {
                console.log(data)
                document.getElementById('id').value = data.id;
                document.getElementById('nameEdit').value = data.name;
                document.getElementById('addressEdit').value = data.price;
                document.getElementById('bedroomEdit').value = data.category.id;

            }
        })
    }
        //
        // //hàm sửa :  sửa cả ảnh
        // function update() {
        //     let id = document.getElementById('id').value;
        //     let formData = new FormData(editForm);
        //     $.ajax({
        //         type: "PUT",
        //         headers:{
        //             Authorization: 'Bearer ' + localStorage.getItem("token")
        //         },
        //         enctype: 'multipart/form-data',
        //         url: API + id,
        //         data: formData,
        //         processData: false,
        //         contentType: false,
        //         cache: false,
        //         success: function () {
        //
        //             // $('#exampleModal').modal('hide');
        //
        //             loadData();
        //             editForm.reset();
        //         },
        //         error: function (error) {
        //             console.log(error)
        //         }
        //     })
        // }
        //

        function logout(){
        localStorage.removeItem('token');

    }


</script>
</body>
</html>